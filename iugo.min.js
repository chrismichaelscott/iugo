/* Author Chris Scott, MIT license */
window.$iugo={};$iugo.$internals={};$iugo.$internals.registerModelMember=function(a,c){Object.defineProperty(a,c,{get:function(){return this.$[c]},set:function(b){b instanceof Promise?b.then(function(e){a[c]=e}):(this.updateView(c,b),this.$[c]=b,$iugo.$internals.applySetters(b,this,[c],b))}})};
$iugo.$internals.applySetters=function(a,c,b,e){if(a instanceof Object||a instanceof Array){for(var d in a){$iugo.$internals.registerProperty(a,d,c,b);var f=b.concat([d]);$iugo.$internals.applySetters(a[d],c,f,e)}a instanceof Array&&$iugo.$internals.registerArray(a,c,b)}};
$iugo.$internals.registerProperty=function(a,c,b,e){b.$[e.concat([c]).join(".")]=a[c];Object.defineProperty(a,c,{get:function(){return b.$[e.concat([c]).join(".")]},set:function(d){b.$[e.concat([c]).join(".")]=d;$iugo.$internals.setChildMembers(a,b,e);b.updateView(e[0],b[e[0]])}})};$iugo.$internals.setChildMembers=function(a,c,b){if(a instanceof Object||a instanceof Array)for(var e in a){var d=b.concat([e]);c.$[d.join(".")]=a[e];$iugo.$internals.setChildMembers(a[e],c,d)}};
$iugo.$internals.registerArray=function(a,c,b){a.push=function(){var a=Array.prototype.push.apply(this,arguments);c[b[0]]=c[b[0]];return a};a.pop=function(){var e=$iugo.$internals.clone(Array.prototype.pop.call(a));c[b[0]]=c[b[0]];return e};a.unshift=function(){for(var a=$iugo.$internals.clone(this),d=0;d<arguments.length;d++)this[d]=arguments[d];for(var f=0;f<a.length;f++)this[d++]=a[f];c[b[0]]=c[b[0]];return this.length};a.shift=function(){var a=$iugo.$internals.clone(Array.prototype.shift.call(this));
c[b[0]]=c[b[0]];return a};a.reverse=function(){for(var a=$iugo.$internals.clone(this),b=0;b<this.length;b++)this[b]=a[this.length-1-b];return this};a.sort=function(){var a=$iugo.$internals.clone(this);Array.prototype.sort.apply(a,arguments);for(var b=0;b<this.length;b++)this[b]=a[b];return this};a.splice=function(){for(var a=$iugo.$internals.clone(this),d=0;d<a.length,d<arguments[0];d++)this[d]=a[d];for(var f=2;f<arguments.length;f++)this[d++]=arguments[f];for(f=arguments[0]+arguments[1];f<a.length;f++)this[d++]=
a[f];for(f=d;f<a.length;f++)this.pop();c[b[0]]=c[b[0]];return this}};$iugo.$internals.clone=function(a){var c;c=a instanceof Array?[]:{};for(var b in a)c[b]=a[b]instanceof Object||a[b]instanceof Array?$iugo.$internals.clone(a[b]):a[b];return c};
$iugo.$internals.MVVC=function(a,c){this.store={};this.scope=c?c:document.body;this.controller={};this.viewcontroller={};for(var b=0;b<this.initializers.length;b++)if(this.initializers[b]instanceof Function)this.initializers[b](this);this.$={};for(var e in a)$iugo.$internals.registerModelMember(this,e),this[e]=a[e]};
$iugo.$internals.MVVC.prototype={updateView:function(a,c){for(var b=0;b<this.defaultViewcontrollers.length;b++)if(this.defaultViewcontrollers[b]instanceof Function)this.defaultViewcontrollers[b](a,c,this.scope,this.store);if("undefined"!==typeof this.viewcontroller[a]&&this.viewcontroller[a]instanceof Function)this.viewcontroller[a](c,this.scope,this.store)},defaultViewcontrollers:[],initializers:[]};$iugo.defaultViewcontrollers=$iugo.$internals.MVVC.prototype.defaultViewcontrollers;
$iugo.initializers=$iugo.$internals.MVVC.prototype.initializers;window.Iugo=function(a,c){return new $iugo.$internals.MVVC(a,c)};
$iugo.initializers.push(function(a){a.store.tags={};a.store.namespacedTagIndex={};a.store.idCounter=0;for(var c=/(>[^<]*)\{\{([^:.}<]+:)?([^}<]*)\}\}([^<]*<)/g;a.scope.innerHTML.match(c);)a.scope.innerHTML=a.scope.innerHTML.replace(c,function(a,c,d,f,k){a=c+"<span ";d&&(a+='class="bindto-'+d.substr(0,d.length-1)+'" ');return a+('data-path="'+f+'"></span>'+k)});a.scope.innerHTML=a.scope.innerHTML.replace(/<[^>]+ [^ =]+="[^"]*\{\{[^}<"]+\}\}[^"]*"[^>]*>/g,function(b){var c=a.store.idCounter++;a.store.tags[c]=
{bindAttributes:[],attributeTemplates:{},replacements:{}};b=b.replace(/([^ =]+)="([^"]*\{\{[^}"]+\}\}[^"]*)"/g,function(b,f,k){"data-iugo_alias-"==f.substr(0,16)&&(f=f.substr(16));a.store.tags[c].bindAttributes.push(f);a.store.tags[c].attributeTemplates[f]=k;k.replace(/\{\{([^"}:]+):[^}"]+\}\}/g,function(b,d){a.store.namespacedTagIndex[d]||(a.store.namespacedTagIndex[d]=[]);-1==a.store.namespacedTagIndex[d].indexOf(c)&&a.store.namespacedTagIndex[d].push(c)});return f+'=""'});return b=b.replace(/ ?>$/,
' data-iugo_id="'+c+'">')})});
$iugo.defaultViewcontrollers.push(function(a,c,b,e){function d(a){for(var b=document.querySelector('[data-iugo_id="'+a+'"]'),c=e.tags[a].bindAttributes,d=0;d<c.length;d++){var f=e.tags[a].attributeTemplates[c[d]].replace(m,function(b){return e.tags[a].replacements[b]?e.tags[a].replacements[b]:""});b.setAttribute(c[d],f)}}function f(a,b,c){if(b.hasAttribute("data-iugo_id")){var f=b.getAttribute("data-iugo_id");b=function(b,d,p){if(!d&&!c||d&&d.substr(0,d.length-1)==c){d=p.split(".");p=a;for(var g=
0;g<d.length;g++)""!==d[g]&&(p=p[d[g]]);e.tags[f].replacements[b]=p}};for(var k=e.tags[f].bindAttributes,g=0;g<k.length;g++)e.tags[f].attributeTemplates[k[g]].replace(m,b);d(f)}}function k(a){var b=a.getAttribute("data-iugo_id"),c=e.idCounter++,b=e.tags[b];e.tags[c]={bindAttributes:b.bindAttributes,attributeTemplates:b.attributeTemplates,replacements:{}};a.setAttribute("data-iugo_id",c)}function g(a,b,c){f(a,b);if(a instanceof Array){c=b.children.length;for(var d=c-1;0<=d;d--)b.children[d].classList.contains("iugo_cloned")&&
b.removeChild(b.children[d]);c=b.children.length;for(d=0;d<c;d++){var e;if(b.children[d].hasAttribute("data-each")){e=b.children[d];0===a.length?(e.setAttribute("data-iugo_display",e.style.display),e.style.display="none"):e.style.display=e.getAttribute("data-iugo_display");for(var l=0;l<a.length;l++){var h;if(1<=l){h=e.cloneNode(!0);h.classList.add("iugo_cloned");h.hasAttribute("data-iugo_id")&&k(h);for(var m=h.querySelectorAll("[data-iugo_id]"),n=0;n<m.length;n++)k(m[n]);b.appendChild(h)}else h=
e;g(a[l],h)}}}}else if(a instanceof Object)if(d=b.getAttribute("data-path"),null!=d&&""!==d)c=null==c?"":c+".",d=d.slice(c.length).split(".")[0],g(a[d],b,c+d);else for(d=0;d<b.children.length;d++)b.children[d].className.match("bindto-")||g(a,b.children[d],c);else if(0<b.children.length)for(d=0;d<b.children.length;d++)g(a,b.children[d],c);else"INPUT"==b.tagName?b.value=a:b.innerHTML=a}var m=/\{\{([^:}]+:)?([^}]+)\}\}/g;if(e.namespacedTagIndex[a])for(var h=e.namespacedTagIndex[a],l=0;l<h.length;l++)for(var q=
b.querySelectorAll('[data-iugo_id="'+h[l]+'"]'),n=0;n<q.length;n++)f(c,q[n],a);a=b.getElementsByClassName("bindto-"+a);for(l=0;l<a.length;l++)g(c,a[l])});$iugo.initializers.push(function(a){"click contextmenu hoverin hoverout focus blur change".split(" ").forEach(function(c){a.scope[getRealEvent(c)]=passEventToController(c,a)})});function getRealEvent(a){"hoverin"==a&&(a="mouseover");"hoverout"==a&&(a="mouseout");return"on"+a}
function getPathFromSplit(a,c){for(var b=null;c;c=c.parentNode){for(var e=0;e<a.length;e++)if(c.isEqualNode(a[e])){for(var b=[],d=0;d<e;d++)b[d]=a[d];break}if(b)break}return b}
function passEventToController(a,c,b){return function(b){var d=null;if(d="hoverin"==a?getPathFromSplit(b.path,b.fromElement):"hoverout"==a?getPathFromSplit(b.path,b.toElement):"click"==a?b.path:[b.path[0]])for(var f=0;f<d.length;f++){var k=d[f];if(k.isEqualNode(this))break;var g=k.getAttribute("data-"+a);if(g&&c.controller[g]instanceof Function)return c.controller[g].call(k,c,b),!1}return!0}}
window.Iugo.http={get:function(a,c,b,e){return this.xhr("get",a,void 0,{},b,e)},xhr:function(a,c,b,e,d,f,k){return new Promise(function(g,m){var h=new XMLHttpRequest;h.onload=function(){200<=this.status&&300>this.status?e instanceof Function?g(e(this.responseText)):this.getResponseHeader("content-type")?g(JSON.parse(this.responseText)):g(this.responseText):m(this)};h.onerror=h.onabort=function(){m(this)};h.open(a,c,!0,f,k);for(var l in d)d.hasOwnProperty(l)&&h.setRequestHeader(l,d[l]);h.send(b)})}};